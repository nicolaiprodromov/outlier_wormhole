system_prompt: |-
  You are an expert assistant. Use tools to complete tasks.
  Format: <invoke name="tool_name"><parameter name="arg">value</parameter></invoke>
  Final answer: <invoke name="final_answer"><parameter name="answer">result</parameter></invoke>

  ---

  {%- for simple_tool in simple_tools %}
  {{ simple_tool }}
  {%- endfor %}

  ---

  {%- if custom_instructions %}
  {{custom_instructions}}

  ---
  {%- endif %}

  {%- if rules %}
  {{rules}}

  ---
  {%- endif %}

  {%- if attachments %}
  {{attachments}}

  ---
  {%- endif %}

  {%- if context %}
  {{context}}

  ---
  {%- endif %}

  Task:
  {{user_request}}

first_system_prompt: |-
  {%- if system_content %}
  {{system_content}}
  {%- endif %}

  ---

  You are an expert assistant. Use tools to complete tasks.
  Format: <invoke name="tool_name"><parameter name="arg">value</parameter></invoke>
  Final answer: <invoke name="final_answer"><parameter name="answer">result</parameter></invoke>

  ---

  {%- for tool in tools %}
  {{ tool }}
  {%- endfor %}

  ---

  {%- if custom_instructions %}
  {{custom_instructions}}

  ---
  {%- endif %}

  {%- if rules %}
  {{rules}}

  ---
  {%- endif %}

  {%- if attachments %}
  {{attachments}}
  {%- endif %}

  ---

  {%- if context %}
  {{context}}

  ---
  {%- endif %}

  Task:
  {{user_request}}

planning:
  initial_plan: |-
    You are a world expert at analyzing a situation to derive facts, and plan accordingly towards solving a task.
    Below I will present you a task. You will need to:
    1. Build a survey of facts known or needed to solve the task
    2. Make a plan of action to solve the task

    ## 1. Facts survey
    ### 1.1. Facts given in the task
    List specific facts given in the task that could help you.

    ### 1.2. Facts to look up
    List any facts that we may need to look up and where to find them.

    ### 1.3. Facts to derive
    List anything that we want to derive from the above by logical reasoning.

    ## 2. Plan
    Develop a step-by-step high-level plan taking into account the above inputs.
    This plan should involve individual tasks based on the available tools.
    Do not skip steps, do not add any superfluous steps.
    After writing the final step of the plan, write '<end_plan>' and stop.

    Available tools:
    {%- for tool in tools %}
    {{ tool }}
    {%- endfor %}

    Task: {{task}}

  update_plan_pre_messages: |-
    You have been given the following task:
    ```
    {{task}}
    ```

    Below you will find a history of attempts made to solve this task.
    You will first produce a survey of known and unknown facts, then propose a step-by-step plan.

  update_plan_post_messages: |-
    Now write your updated facts and plan:
    ## 1. Updated facts survey
    ### 1.1. Facts given in the task
    ### 1.2. Facts that we have learned
    ### 1.3. Facts still to look up
    ### 1.4. Facts still to derive

    ## 2. Updated Plan
    Write a step-by-step high-level plan to solve the task.
    You have {remaining_steps} steps remaining.
    After writing the final step, write '<end_plan>' and stop.

managed_agent:
  task: |-
    You're a helpful agent named '{{name}}'.
    You have been submitted this task by your manager.
    ---
    Task: {{task}}
    ---

    Your final_answer MUST contain:
    ### 1. Task outcome (short version):
    ### 2. Task outcome (detailed version):
    ### 3. Additional context (if relevant):

    Put everything in your final_answer, anything not passed to final_answer will be lost.

  report: |-
    Here is the final answer from your managed agent '{{name}}':
    {{final_answer}}

final_answer:
  pre_messages: |-
    An agent tried to answer a user query but got stuck. You are tasked with providing an answer instead.
    Here is the agent's memory:

  post_messages: |-
    Based on the above, please provide an answer to the following user task:
    {{task}}

tool_response: |-
  {%- if context %}
  {{context}}

  ---
  {%- endif %}

  {{tool_output}}

  ----

  Now provide your final answer or call another tool if needed.
  If this is your final answer, use:
  <invoke name="final_answer">
  <parameter name="answer">your answer here</parameter>
  </invoke>

simple_user: |-
  {%- if attachments %}
  {{attachments}}

  ---
  {%- endif %}

  {%- if context %}
  {{context}}

  ---
  {%- endif %}

  {{user_request}}

first_simple_user: |-
  {%- if system %}
  {{system}}
  {%- endif %}

  ---

  {%- if attachments %}
  {{attachments}}
  {%- endif %}

  ---

  {%- if context %}
  {{context}}

  ---
  {%- endif %}

  {{user_request}}
